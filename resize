#!/usr/bin/env bash 
# An executable that guides you to formulating the correct `parted` command to
# resize your linux partition. I've only used this on
main() {
	echo "This executable guides you through the process of resizing a linux"
	echo "partition using the parted command -- something I do once every 6"
	echo "months, and so can never remember exactly how to do."
	echo ""
	echo "This executable requires sudo, but will not use it to mutate your"
	echo "system. It's just a guide that prints the final command you need to"
	echo "run."
	echo ""
	sudo true
	echo ""
	echo "The syntax of the final parted command is something like"
	echo ""
	echo "   sudo parted DEVICE resizepart PARTITION_NUMBER END"
	echo ""
	echo "The correct value of DEVICE is probably whichever device is the"
	echo "largest, or the device returned for the current working directory"
	echo ""
	echo "    df --output=source ."
	printf "    " && df --output=source . | tail -n 1
	echo ""
	echo "It should be relatively obvious from the following list of devices."
	echo ""
	local -r any_device_name="$(df --output=source . | tail -n 1)" || return 1
	sudo parted "$any_device_name" print devices
	echo ""
	echo "Note, if you see a device like ubuntu--vg-ubuntu-lv, then your"
	echo "host is using logical volume management (LVM), and this guide"
	echo "won't work for you. You can quit with CTRL-C/CTRL-D."
	echo ""
	read -p "Enter the DEVICE to resize: "
	local -r device="$REPLY"
	echo ""
	echo "The values of PARTITION_NUM and END should be obvious from the"
	echo "following print out, generated by running"
	echo ""
	echo "    sudo parted $device print list"
	echo ""
	echo "Again, the correct PARTITION_NUM is probably whichever is largest."
	echo ""
	sudo parted "$device" print list
	echo ""
	read -p "Enter the PARTITION_NUM to resize: "
	local -r partition_num="$REPLY"
	read -p "Enter the value of END to resize to (include GB): "
	local -r end="$REPLY"
	echo ""
	echo "Based on your answers to the above prompts, the commands to"
	echo "run to resize your partition and then filesystem are"
	echo ""
	echo "    sudo parted $device resizepart $partition_num"
	echo "    <at prompt enter end $end>"
	echo ""
	echo "    sudo resize2fs $device"
	echo ""
	echo "Run these commands to resize disk! ☝️"
	echo ""
	echo "For further help, see: https://wiki.archlinux.org/title/Parted#Growing_partitions"
	return 0
}

main $@ || exit 1
